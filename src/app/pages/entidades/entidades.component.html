<app-page-header [title]="'ENTIDADES'" backUrl="panel" />
<div class="grid grid-cols-1">
  <nz-table [nzScroll]="{ x: 'max-content' }" class="min-w-full" [nzTitle]="HeaderEntidades" nzShowSizeChanger nzSize="small"
    [nzData]="entidades()" [nzFrontPagination]="false" [nzLoading]="loading" [nzTotal]="pagination.total!"
    [nzPageSize]="pagination.pageSize!" [nzPageIndex]="pagination.currentPage!" (nzQueryParams)="onQueryParamsChange($event)">
    <thead>
      <tr>
        <th nzWidth="80px" nzAlign="center" nzColumnKey="ubigeo" [nzSortFn]="true">Ubigeo</th>
        <th nzWidth="100px" nzAlign="center">Departamento</th>
        <th nzWidth="100px" nzAlign="center">Provincia</th>
        <th nzWidth="100px" nzAlign="center">Distrito</th>
        <th nzWidth="120px" nzAlign="center">Entidad</th>
        <th nzWidth="120px" nzAlign="center">Partido Politico</th>
        <th nzWidth="80px" nzAlign="center">DNI</th>
        <th nzWidth="120px" nzAlign="center">Nombres</th>
        <th nzWidth="120px" nzAlign="center">Cargo</th>
        <th nzWidth="80px" nzAlign="center">Sexo</th>
        <th nzRight nzWidth="80px" nzAlign="center"></th>
      </tr>
    </thead>
    
    <tbody>
      @for(entidad of entidades(); track $index){
        <tr>
          <td nzAlign="center"><p class="w-full" nz-tooltip [nzTooltipTitle]="esAdmin ? tooltipUbigeo : null" [nzTooltipTitleContext]="{ entidad: entidad }">{{entidad.ubigeo_oficial}}</p></td>
          <td nzAlign="center">{{entidad.departamento}}</td>
          <td nzAlign="center">{{entidad.provincia}}</td>
          <td nzAlign="center"><p class="w-full" nz-tooltip [nzTooltipTitle]="esAdmin ? tooltipDistrito : null" [nzTooltipTitleContext]="{ entidad: entidad }">{{esAdmin ? entidad.distrito : entidad.distritoMef}}</p></td>
          <td nzAlign="center"><p class="w-full" nz-tooltip [nzTooltipTitle]="entidad.nombre">{{entidad.entidadTipoSlug}}</p></td>
          <td nzAlign="center">{{entidad.partidoPolitico}}</td>
          <td nzAlign="center">{{entidad.dnAutoridad}}</td>
          <td nzAlign="center">{{entidad.nombreAutoridad}} {{entidad.apellidosAutoridad}}</td>
          <td nzAlign="center">{{entidad.cargoAutoridad}}</td>
          <td nzAlign="center">{{entidad.sexoAutoridad}}</td>
          <td nzRight nzAlign="center">
            <div class="flex justify-center">
              <div *ngIf="entidadesActions.servicejne" class="p-1 cursor-pointer font-bold text-sky-700 hover:text-sky-800" nz-tooltip [nzTooltipTitle]="'Actualizar segÃºn JNE de ' + entidad.nombre" (click)="obtenerAutoridadJne(entidad)">
                <i class="pi pi-building-columns" style="font-size: .85rem;"></i>
              </div>
              <a *ngIf="entidadesActions.view" [routerLink]="[entidad.entidadId]" class="py-1 px-2 font-bold text-sky-700 hover:text-sky-800" nz-tooltip nzTooltipTitle="Ver detalle">
                <i class="pi pi-eye" style="font-size: 0.85rem"></i>
              </a>
            </div>
          </td>
        </tr>
        }
    </tbody>
  </nz-table>
  <ng-template #tooltipUbigeo let-entidad="entidad">
		<div>
			<div><strong>Ubigeo: </strong> {{entidad.ubigeo}}</div>
			<div><strong>Ubigeo Oficial: </strong> {{entidad.ubigeo_oficial}}</div>
			<div><strong>Ubigeo JNE: </strong> {{entidad.ubigeo_jne}}</div>
		</div>
	</ng-template>

  <ng-template #tooltipDistrito let-entidad="entidad">
		<div>
			<div><strong>Distrito: </strong> {{entidad.distrito}}</div>
			<div><strong>Distrito MEF: </strong> {{entidad.distritoMef}}</div>
		</div>
	</ng-template>
  
  <ng-template #HeaderEntidades>
    <div class="ant-table-header flex flex-col sm:flex-row justify-between items-center">
      <p class="mb-2 sm:mb-0">Resultados {{pagination.total}}</p>
      <div class="flex gap-2">
        <div *ngIf="entidadesActions.report" class="cursor-pointer flex items-center gap-1 py-1 px-3 rounded border border-sky-700 text-sky-700 hover:bg-sky-700 hover:text-white" (click)="openFilters = true">
          <i class="pi pi-filter" style="font-size: 0.75rem"></i>
          <span class="hidden md:flex">Filtros</span>
        </div>

        <!-- <div class="cursor-pointer flex items-center gap-1 py-1 px-3 rounded border border-sky-700 bg-sky-700 text-white hover:bg-sky-800 hover:border-sky-700">
          <i class="pi pi-plus" style="font-size: 0.75rem"></i>
          <span class="hidden md:flex">Nueva entidad</span>
        </div> -->
      </div>
    </div>
  </ng-template>
</div>

<app-filtro-entidad *ngIf="openFilters" [visible]="openFilters" [pagination]="pagination" (visibleDrawer)="openFilters = false" (save)="saveFilters($event)" (filters)="generateFilters($event)" />
